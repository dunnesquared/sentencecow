{% extends "layout.html" %}


{% block content %}

  <h1>Results</h1>
  <h2>Original Text</h2>
  <p><pre>{{input_text}}</pre></p>
  <p class="result-count">Word Count: {{wordcounts['original']}}</p>

  <!--Only worth displaying if there's actually sentences to be parsed.-->
  {% if (sentences|length) != 0 %}

        <!--Build highlighted text with pre-tags -->
        <h2>Parsed Text (Long sentences highlighted; ❖  = sentence break)</h2>
        <p>
            {% for item in highlight_data %}
              {% set start = item[0] %}
              {% set end = item[1] %}
              {% set highlight = item[2] %}
              {% set whitespace = item[3] %}

              <!-- Print any white space characters preceding sentence
                   to preserve formatting of original text.-->
              <pre>{{whitespace}}</pre>

              {% if highlight == true %}
                  <pre class="highlight">{{input_text[start:end]}}</pre>
              {% else %}
                <pre>{{input_text[start:end]}}</pre>
              {% endif %}

                <!-- Place a separator between detected sentences. This will
                be helpful to detect where a sentence was split in the middle
                of a word, creating different word counts between original
                and parsed texts.
                -->
                <pre> ❖ </pre>

            {% endfor %}
        </p>

        <p class="result-count">Word Count: {{wordcounts['parsed']}}</p>

        <h2>Details</h2>


        <table id="sent-table">
          <tr>
            <th>#</th>
            <th>Sentence</th>
            <th># words</th>
            {% if max > 1 %}
              <th>More than {{max}} words?</th>
            {% else %}
              <th>More than {{max}} word?</th>
            {% endif %}
          </tr>

          <!-- Highlight the rows where sentences exceed word max -->
          {% for s in sentences %}
            {% if s['wordcount'] > max %}
              <tr style="background-color: yellow">
            {% else %}
              <tr>
            {% endif %}

              <td class='cell'> {{loop.index}}</td>
              <td><p>{{s['content']}}</p></td>
              <td class='cell'>{{s['wordcount']}}</td>

              <!-- Highlight the rows where sentences exceed word max -->
              {% if s['wordcount'] > max %}
                <td class='cell'>Y</td>
              {% else %}
                <td class='cell'>N</td>
              {% endif %}

            </tr>
          {% endfor %}

        </table>


        {% if wordcounts['original'] != wordcounts['parsed'] %}
          <p><b>Warning:</b><br> The word counts of your original and parsed
          texts are different ({{wordcounts['original']}} vs.
          {{wordcounts['parsed']}} words, respectively).
          It's likely that the last part of the original
          text wasn't included in the parsing because no terminating
          punctuation
          mark was used at the end of the text (i.e. the last bit didn't form
          a 'valid' sentence). You can fix this by hitting your browser's
          back button and adding a terminating punctuation mark at the end of
          your text.
         </p>
         <p>Alternatively, if you used the Split feature below in the middle
           of a word, the parsed text's wordcount will be one higher
           than the original text's wordcount.
         </p>
        {% endif %}

        <!--To use later!!-->
        <!--<p>Total: {{ sentences|sum(attribute='wordcount')}}</p>-->

        <h1>Not quite right?</h1>

        <div><h2>Divided sentence</h2></div>
         Sometimes detected sentences are shorter than they actually are,
           especially when quotes and abbreviations are involved. To combine to
           two consecutive too-short sentences, click 'Merge' on the sentence
           you want to be joined with the one following it.
         <p></p>


        <form action="leguinncounter" method="POST">

          <!--HTTP is a stateless protocol; need to send this info back, so we
         can redisplay it once the CGI web script is done processing-->
          <input type='hidden' name="max" value="{{max}}"></input>
          <input type='hidden' name="input_text" value="{{input_text}}"></input>

          <!-- Need to resend the sentence list in case sentences have been
           previously merged: parsing the original text will bring us back give
          us sentences before they were merged.-->
          {% for i in range(sentences|length) %}
            <input type='hidden' name="sent_list[]" value="{{sentences[i]['content']}}"</input>
          {% endfor %}



          <!-- Index of sentence chosen to merge with next-->
          <select name="index">
            {% for i in range(sentences|length) %}
              <option value="{{ i }}">
                {{loop.index}}) {{sentences[i]['content']}} (# words: {{sentences[i]['wordcount']}})
              </option>
            {% endfor %}
          </select>

          <div>
              <br>
            <input name="submit_button" type="Submit" value="Merge"></input>
          </div>

        </form>
        <!------------------------------------------------------->

        <p></p>
        <p></p>
          <div><h2>Multiple sentences in one</h2></div>
          Occasionally, the program will combine two complete sentences when
            it shouldn't. This can happen when there is no space right after a
            terminating punctuation mark, as with footnote references. e.g.
          <i>The full moon is an ecclesiastical full moon determined by reference
             to a conventional cycle.[1]</i> (Wikipedia: "Computus")

          <p>To fix this, follow the steps below to separate the sentences.
          Note that you can only divide a sentence into at most two parts.
          If you need to do more splits, just repeat the process.
        </p>

          <p>1. Choose the offending sentence from the drop-down list.</p>

         <!-- Select sentence

         <select id='sel_split'>
           <option>This is one sentence.</option>
           <option>This is another sentence. I am yet another.</option>
           <option>PIZZA! It's the best.</option>
           <option>This is a sentence with a footnote.[1]</option>
         </select>
          -->


         <!-- Index of sentence chosen to merge with next-->
         <form action="leguinncounter" method="POST">

           <!--HTTP is a stateless protocol; need to send this info back, so we
          can redisplay it once the CGI web script is done processing-->
           <input type='hidden' name="max" value="{{max}}"></input>
           <input type='hidden' name="input_text" value="{{input_text}}"></input>

           <!-- Need to resend the sentence list in case sentences have been
            previously merged: parsing the original text will bring us back give
           us sentences before they were merged.-->
           {% for i in range(sentences|length) %}
             <input type='hidden' name="sent_list[]" value="{{sentences[i]['content']}}"</input>
           {% endfor %}

           <select id ="sel_split" name="index">
             <option disabled selected value> --Pick a sentence to split---</option>
             {% for i in range(sentences|length) %}
               <option value="{{sentences[i]['content']}}">
                 {{loop.index}}) {{sentences[i]['content']}} (# words: {{sentences[i]['wordcount']}})
               </option>
             {% endfor %}
           </select>

           <p>2. Click or tap where the sentence should be split.</p>
           <!-- Print sentence in textarea--->
           <div>
           <textarea
            id='sentencetextarea'
            name='split_textarea'
            placeholder="Selected sentence will go here..."
            readonly></textarea>
           </div>

           <p>3. Confirm and split! </p>

           <p>The selected sentence text will be split as follows:<br>
                <pre id='output_area'></pre>
          </p>

          <!--Data to send back-->
          <input id="sent_index" type="hidden" name="sentindex" value="">
          <input id="split_pos" type="hidden" name="splitposition" value="">
          <input id="first_part" type="hidden" name="firstpart" value="">
          <input id="second_part" type="hidden" name="secondpart" value="">

         <input name="submit_button" type="Submit" id='split' value="Split" disabled></input>

         <!---DEBUGGING-->
         <p><pre id="saved"></pre></p>
      </form>

    {% else %}
      <h1>Nothing to process!</h1>
      <p>There are no sentences to process. Either you entered nothing, entered
      only whitespace characters, or wrote a phrase without a sentence-ending
      punctuation mark.</p>

    {% endif %}


<br>
<a href="http://localhost:5000/leguinncounter">Return to main page</a>

<script type="text/javascript" src="{{ url_for('static', filename='split.js') }}"></script>

{% endblock %}
